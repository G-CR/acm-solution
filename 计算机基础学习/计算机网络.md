# 计算机网络

## 1、TCP怎么保证可靠性 p133

1、序列号、确认应答、超时重传

数据达到接收方，接收方需要发出一个确认应答，表示已经接收到该数据段，并且确认序号会说明它下一次需要接收的数据序列号。如果发送迟迟未收到确认应答，那么可能是发送的数据丢失，也可能是确认应答丢失，这时发送方在等待一段时间后会进行重传，这个时间一般是2*rtt+一个偏差值。

2、窗口控制、快速重传

TCP会利用窗口控制来提高传输速度，意思就是在一个窗口大小内，不用一定要等到应答才能发送下一段数据，窗口大小就是无需等待而可以继续发送数据的最大值，如果不适应窗口控制，每一个没确认应答的数据都要重发。

使用窗口控制，如果数据段1001～2000丢失，后面的数据每次传输，确认应答都会不停的发送序号为1001的应答，表示我要接受1001开始的数据，发送端如果收到3次相同的应答，就会立刻进行重发；但还有一种情况就是数据收到了，但是有的应答丢失了，这种情况就不会重发，因为发送端知道，如果是数据丢失，接收端不会放过它的，就会疯狂提醒。

3、拥塞控制

如果把窗口定的很大，发送端连续发送大量的数据，可能会造成网络的拥堵，甚至网络的瘫痪，所以TCP为了防止这种情况的发生而进行了拥塞控制。

慢启动：定义拥塞窗口，一开始将该窗口大小设置为1，之后每次收到的确认应答，将拥塞窗口大小乘以2

拥塞避免：设置慢启动阈值，一般开始为65336，拥塞避免实质当拥有窗口大小达到这个阈值的时候拥塞窗口的值不再指数上升，而是加法增加（每次确认应答/每个rtt，拥塞窗口大小+1），以此来避免拥塞。

快速重传：再遇到3次重复的确认应答时，代表收到了3个报文段，但是这之前的1个段丢失了，便对它进行立即重传。然后，先将阈值设置为当前窗口大小的一半，然后再将窗口大小设置为慢启动阈值+3的大小。这样可以达到：TCP通信时，网络吞吐量呈现逐渐上升，并且随着拥堵来降低吞吐量，再慢慢上升的过程，网络不会轻易瘫痪。



## 2、简述一下TCP建立连接和断开连接的过程 p133

三次握手：

1、client将SYN设置为1，并且随机生成一个值seq=j，然后把这个数据包发送给server，此时client的状态变为SYN_SENT

2、sever收到数据包后，检查SYN的值是否为1，如果正确就将SYN的值设置为1，并且随机生成了一个值seq=k，并且将ack的值设置为j+1，把ACK的值设置为1，然后将此数据包发送给client，sever的状态变为SYN_RCVD

3、client收到数据包后检查ACK的值是否为1，ack的值是否为j+1，SYN的值是否为1，如果正确就将ACK的值也设置为1，将ack的值设置为k+1，然后把该数据包发送给server，server接收到数据包后检查ack的值是否为k+1，ACK的值是否为1，如果正确，client与server的状态都改为ESTABLISHED，然后双方可以开始发送数据了。

四次挥手：

由于TCP是全双工通信，所以在关闭连接的时候是需要两遍分表关闭的，所以在当一边发出FIN的报文段时，只是单方面关闭了发送数据的通道，而另一边仍然可以发送数据，直到另一边也发出了FIN报文段时，才意味着连接断开。

1、客户端向服务端发送FIN的释放信号，此时客户端向服务端发送数据的通道关闭，状态变为FIN_WAIT_1。

2、服务端收到客户端的FIN信号后，反馈一个ACK=1的确认应答，确认序列号为收到的序号+1，客户端进入FIN_WAIT_2状态，服务端进入CLOSE_WAIT状态

3、当服务端没有数据需要发送时，向客户端发送一个FIN信号，等待客户端确认，服务器进入LAST_ACK状态。

4、客户端收到FIN信号后，给服务器发送一个ACK报文，确认序列号为收到的序号+1，此时客户端状态变为TIME_WAIT状态，等待2MSL，然后连接关闭。

## HTTP和HTTPS的区别 p137

1、http传输是以明文的方式进行传输的，https是经过TLS加密后传输的，具有更高的安全性

2、https在tcp的三次握手之后，还需要进行SSL的handshake过程，协商加密使用的是对称加密密钥

3、https需要服务端申请证书，浏览器端安装对应的根证书

4、http协议端口是80，https的协议端口443

## HTTPS的优缺点 P137

优点：

1、https在传输过程中使用密钥加密，所以安全性更高

2、https协议需要用户和服务器安装证书，所以数据具有识别性，保证可以发送到对应的用户或者服务器

缺点：

1、在握手期间延时较高：因为在进行tcp握手之前还需要进行SSL的handshake，所以延时会更高

2、部署成本高，由于是加密过的数据，所以在传输数据前后会存在加解密的过程，占用CPU资源也会更高，所以需要提高服务器的配置或者数目。

## IP地址以及MAC地址的作用 P139

MAC地址是一个硬件地址，用来定义网络设备的位置，主要由数据链路层负责

IP地址是由IP协议提供的一种统一的地址格式，为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。



## 搜索百度，会用到计算机网络中的什么层？每层是干什么的？P141

浏览器先输入一个URL地址，解析URL地址需要使用dns协议，首先主机先查询dns缓存，如果没有就给本地dns发送查询请求，dns查询分为两种方式：一种是递归查询，一种是迭代查询。如果是迭代查询的话：本地的dns服务器会想根域名服务器发送查询请求，根域名服务器会告知该域名的一级服务器，然后本地服务器就向该一级域名服务器发送查询请求，以此类推就可以查询到该域名的IP地址。dns是基于udp的，所以需要使用到udp协议。

得到IP地址后，浏览器需要建立一个http连接，所以需要使用http协议，如果使用https连接，那么就需要使用https对http协议加密。然后http会生成一个get请求，发送到TCP层去处理，这里就需要使用到TCP协议，TCP层如果有需要就将http数据分片，。然后将数据发送给IP层，需要使用到IP协议。IP通过路由选路，一跳一跳到目的地址。如果在一个网段内选址是通过以太网实现的就需哟啊以太网协议，以太网选址需要知道对方的物理地址，所以就需要ARP协议。

dns协议、http协议、https协议属于应用层

TCP/UDP协议属于传输层

IP协议，ARP协议属于网络层



## TCP/IP数据链路层的交互过程

网络层到数据链路层需要将IP地址转换为mac地址，在转换的时候，首先会查询自己的arp缓存表（存储着ip-mac信息）中是否存有对应的关系，如果有就把mac地址封装到这个数据包的包头，如果没有就会发送一个广播：who is ip xxx tell ip xxx，这个时候收到该通知的机器会检查自己的ip是否为这个，如果是的就会以单拨的形式将自己的mac地址发送给广播的机器。

## 请你说说传递到IP层怎么知道报文该给哪个应用程序，他怎么区分UDP和TCP报文

根据端口区分

看ip头中的协议标示字段，17时udp，6时TCP

## 网络编程的基本步骤

服务端：socket - bind(绑定端口号) - listen(监听连接) - accept(接受连接请求) - send/recv(发送/接受数据) - close

客户端：socket - connect - send/recv - close

## server端监听端口，但还没有客户端连接进来，此时进程处于什么状态？

这个需要看服务端的变成模型，如果如同上一个问题的回答描述的这样，则处于阻塞状态，如果使用了epoll，select等这样的io复用情况下，处于运行状态。



